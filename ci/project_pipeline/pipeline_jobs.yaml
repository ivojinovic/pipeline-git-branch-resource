- name: isolation-tests-master-branch
  plan:
  - get: master-branch
    trigger: true
  - task: isolation-tests-task
    config:
      platform: linux
      image_resource:
        type: docker-image
        source:
          repository: docker.zipcar.io:443/cheetah_ruby
          tag: ruby23
      run:
        path: cheetah/ci/scripts/isolation_tests.sh
        args: []
        dir: ""
      inputs:
      - name: master-branch
        path: cheetah

- name: build-master-branch
  public: true
  serial: true
  plan:
  - get: cheetah_ruby
    trigger: true
  - get: master-branch
    passed:
    - isolation-tests-master-branch
    trigger: true
  - task: get-tag
    config:
      platform: linux
      image_resource:
        type: docker-image
        source:
          repository: docker.zipcar.io:443/cheetah_ruby
          tag: ruby23
      params:
        APP_NAME: (( grab $PROJECT_NAME ))
        GET_TAG_OUTPUT_DIR: get-tag-outputs
        REDIS_HOST: 192.168.72.226
      run:
        path: cheetah/ci/scripts/get_tag.sh
        args: []
        dir: ""
      inputs:
      - name: master-branch
        path: cheetah
      outputs:
      - name: get-tag-outputs
        path: ""
  - put: master-build
    params:
      build: master-branch
      tag: get-tag-outputs/tag
